% This is the template Jun uses for project seeds
% jun.allard@uci.edu allardlab.com
\documentclass[onecolumn,11pt]{article}

% --------- required packages ---------
\usepackage{enumerate}
\usepackage{enumitem}
\usepackage{graphicx}
\usepackage[colorlinks,allcolors=black]{hyperref}
\usepackage[font=small]{caption}
\usepackage{siunitx}
\usepackage{times}
\usepackage{titlesec}

\usepackage{titling}
\usepackage{authblk} % must come after titling package loading

\usepackage[utf8]{inputenc}


% The new package!
\usepackage{internalsubfigures}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% page layout
\usepackage[margin=1in]{geometry}

% paragraph layout
\setlength{\parindent}{0pt} % paragraph indent - looks best zero
\setlength{\parskip}{0.8em plus 0.1em minus 0.1em} % paragraph spacing
\setlist[itemize]{itemsep=0.0em,topsep=0em}
\setlist[enumerate]{itemsep=0.0em,topsep=0em}
\titlespacing{\paragraph}{0em}{-0.8em}{1em} % for the /paragraph command

% Bibliography setup
\usepackage[numbers,square,sort&compress]{natbib}
\bibliographystyle{unsrtnat}
%\bibliographystyle{biophysj}

\title{A latex package to label externally-created subfigures}
\author[a]{Jun Allard}
\affil[a]{University of California Irvine}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\date{} % leave blank for no date
\begin{document}

\maketitle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\begin{abstract}
%Nothing here yet
%\end{abstract}


\section{The old way of referencing figures}


\begin{figure}[ht]
        \centering
        \includegraphics[width=4.5in]{example-image} 
        \caption{A sentence describing the whole figure, which is about a fictional protein called ``oldschoolin''.
        (A) A family of curves that means nothing on its own.
        (B) A ribbon diagram of ``oldschoolin".
        \label{fig:oldschool}}
\end{figure}

I would like to refer to the main figure about ``oldschoolin'', shown in Figure~\ref{fig:oldschool}. 
But this less informative, and instead I should refer to specific panels.
Now, I would like to just refer the family of curves in Figure~\ref{fig:oldschool}A.
And now, I would like to just refer to the ribbon diagram in Figure~\ref{fig:oldschool}B.
If you need to change the subfigures, you need to change the above references manually.


\clearpage

\section{The ``busyfigure'' way to reference figures}

\begin{busyfigure}[ht]
        \centering
        \includegraphics[width=4.5in]{example-image} 
        \firstsentence{A sentence describing the whole figure.}
        \internalsubfigure{fig:track}{(A) A track that means nothing on its own.}
        \internalsubfigure{fig:pcolor}{(B) A pcolor map that also means nothing on its own.}
        \lastsentence{All the data in this figure are scaled by the size of the universe.}
        \majorlabel{fig:omics_conclusion}
\end{busyfigure}

I would like to refer to the main figure Figure~\ref{fig:omics_conclusion}. 
But this less informative, and instead I should refer to specific panels.
Now, I would like to just refer to the track, Figure~\ref{fig:track}.
And now, I would like to just refer to the colormap, Figure~\ref{fig:pcolor}.
These panels are referenced directly, which means that they will automatically update if you move their captions around.

\clearpage

\begin{busyfigure}[ht]
        \centering
        \includegraphics[width=4.5in]{example-image} 
        \internalsubfigure{fig:gel}{(A) A gel.}
        \internalsubfigure{fig:heatmap}{(B) A heatmap}
        \majorlabel{fig:results_figure}
\end{busyfigure}

I would like to refer to the main figure Figure~\ref{fig:results_figure}.
But this less informative, and instead I should refer to specific panels.
Now, I would like to just refer to the gel, Figure~\ref{fig:gel}.
And now, I would like to just refer to the heatmap, Figure~\ref{fig:heatmap}.

%\clearpage

\begin{busyfigure}[ht]
        \centering
        \includegraphics[width=4.5in]{example-image} 
        \internalsubfigure{fig:schematic}{(A) A schematic to show how all the parts fit together}
        \internalsubfigure{fig:referee_experiment}{(B) A useless and wasteful experiment suggested by Reviewer \#3}
        \majorlabel{fig:final_figure}
\end{busyfigure}

I would like to refer to the main figure Figure~\ref{fig:final_figure}. But this less informative, and instead I should refer to specific panels.
Now, I would like to just refer to the schematic, Figure~\ref{fig:schematic}.
And now, I would like to just refer to the referee-recommended experiment, Figure~\ref{fig:referee_experiment}.

\subsection*{Discussion}

In the discussion, I will discuss many different subpanels in many different figures.
For example, the gel in Fig.~\ref{fig:gel}, and the schematic in Fig.~\ref{fig:schematic}.
Or how about the genomic track in Fig.~\ref{fig:track}.

If we move these panels around, all we need to do is change it in the captions (in the \verb|internalsubfigure| lines), and it with automatically change throughout the document! 

\end{document}

