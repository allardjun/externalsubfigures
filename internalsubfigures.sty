\ProvidesPackage{internalsubfigures}[2024/02/09 v1.0 Jun's internal subfigure labeler]

\RequirePackage{subcaption}
\RequirePackage{etoolbox}


% ------ first pass, separate labels and captions -------

\newcommand{\internalsubfigurelabel}[1]{
  \begin{subfigure}[b]{0.001\textwidth}\caption{}
    \label{#1}
  \end{subfigure}
}

\renewcommand\thesubfigure{\Alph{subfigure}}
\DeclareCaptionLabelFormat{empty}{}
\captionsetup[subfigure]{labelformat=empty}


% ------ second pass, combine labels and captions -------

% % Define a new environment 'internalcaption'
\newenvironment{internalcaption}
  {% This code is executed at \begin{myenvironment}
   \resetlabellist % Reset the list at the beginning
   \resetcaptionlist
  }
  {% This code is executed at \end{myenvironment}
   %\par\noindent\textbf{Accumulated Content:}\par
   %\labellist % Use the accumulated content here
   %\captionlist % Use the accumulated content here
   \processinternalcaption

  }



% Command to add a new element to labellist and captionlist
\newcommand{\labellist}{}
\newcommand{\captionlist}{}

% Command to add a new element to labellist and captionlist
\newcommand{\internalsubfigure}[2]{%
  \ifdefempty{\labellist}
    {\def\labellist{#1}}
    {\edef\labellist{\labellist,#1}} % Append with comma
  \ifdefempty{\captionlist}
    {\def\captionlist{#2}}
    {\edef\captionlist{\captionlist,#2}} % Append with comma
}

% Command to clear the labellist and captionlist
\newcommand{\resetlabellist}{\renewcommand{\labellist}{}}
\newcommand{\resetcaptionlist}{\renewcommand{\captionlist}{}}

\newcommand{\processinternalcaption}{%
  \renewcommand*\do[1]{%
    % This is where each item is actually processed
    Item: ##1\par
  }
  \expandafter\docsvlist\expandafter{\labellist}
} 

 
\endinput
